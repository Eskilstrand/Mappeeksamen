---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Assignment 1: Reliability and tools for reproducible data science {#assignment1}

The purpose of this assignment is to present estimates of reliability of measures collected in the physiology lab. A second purpose is to use tools for reproducible data science. The report that you are expected to hand in therefore has some strict requirements in its format (see [assignment description](https://dhammarstrom.github.io/quant-methods-workshops/assignment-1.html)). The assignment is a group assignment and at least three students are expected to contribute to each report.

## Elements of the report

**Importantly, the report should contain:**

-   At least one table (created from your data)
-   At least one figure (created from your data), and
-   data presented in the text.
-   The report should use a bibliography file to manage references.

## **Starten av rapport**

## **Protokoll for vo2maks testing**


### Forberedelser før test
- Gjennomfør samme type trening dagen før test 
- Standardiser siste måltid før test (frokost) 
- Innta normal mengde (for deg) med koffein før test 
- Unngå alkohol/nikotin/tobakk siste 72t før test 

### Arbeidsflyt

1. Skru på BIOSEN
2. Finne frem slange
3. Starte kalibrering (gass) av Vyntus
4. Skru sammen munnstykke mens kalibrering pågår
5. Ta volumkalibrering (Vyntus)
6. Ta vekt på personen
7. Legg inn deltagerprofil på LODE
8. Stille inn sykkel og montere riktige pedaler
9. Kalibrer krank
10. Zeroing av Vyntus


### Test protocol

Vyntus (Jaeger Vyntus CPX, Hoechberg, Tyskland) kalibreres før test, og brukes til å måle oksygenopptak. Gassanalysator kalibreres til < 2,0% differanse og luftvolum kalibreres til < 0,2% differanse. Zeroing gjøres også alltid før test starter. Syklistene veies med de klærne de skal sykle med, og 0,3kg trekkes fra.  
  
Sykkeltesten gjennomføres på en ergometersykkel med bukkestyre (Lode Excalibur Sport; Lode B.V., Groningen, Nederland). Kranken kalibreres på Lode sykkelen før hver teststart, og sykkel stilles inn etter utøver sitt ønske ved første test og stilles inn til den samme sittestillingen påfølgende tester. 
  
Test av det maksimale oksygenopptaket (VO2maks) gjennomføres etter 5 min standarisert oppvarming 2min på 11-12 i Borg, deretter 2 min på 15 i Borg før 1 min på 11-12 i Borg. Testen starter på en watt bestemt utfra deltagerens nivå i samråd med deltager og testleder. Det viktigste er at videre tester starter på samme watt. Det er individuelt om testen øker med 20W eller 25W hvert minutt frem til utmattelse. Testleder gjør verbal oppmuntring og sekundering. Oksygenmålinger hvert 30 sek, og snittet av de to høyeste etterfølgende målingene er det som brukes som det maksimale oksygenopptaket. Deltager er på forhånd informert om at testen stopper når kadens er under 60 rpm. Umiddelbart ved utmattelse blir deltaker spurt om Borg skala. Ett minutt etter endt VO2maks-test stikker vi på fingertupp og måler [bLa-]. 


```{r}
#| echo: false
#| message: false

library(readxl)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(magrittr)
library(gt)
df <- read_xlsx("data/o2-test.xlsx")

```



### Tabell over o2-tester med utvalgt data

```{r}
#| code-fold: true
#| warning: false

df %>% 
  select(id, age, weight, w.max, vo2.max, hr.max, la.max, borg.max) %>% 
  mutate(rel.vo2max = vo2.max / weight) %>% 
  arrange(w.max) %>% 
  gt(auto_align = TRUE) %>% 
  fmt_number(columns = w.max,
             decimals = 0) %>% 
  fmt_number(columns = vo2.max,
             decimals = 0) %>% 
  fmt_number(columns = rel.vo2max,
             decimals = 1) %>% 
  fmt_number(columns = age,
             decimals = 0) %>% 
  cols_label(id = "ID",
             age = "Alder",
             weight = "Vekt",
             w.max = md("Watt<sub>maks</sub>"),
             vo2.max = md("VO<sub>2maks</sub><br><small>(ml/min)</br></small>"),
             hr.max = md("HF<sub>maks</sub>"),
             la.max = md("Lak<sub>maks</sub>"),
             borg.max ="Borg",
             rel.vo2max = md("VO<sub>2maks</sub><br><small>(ml/kg/min)</br></small>"))




```


### Figur fra o2-test

```{r}


df %>% 
  mutate(rel.vo2max = vo2.max / weight) %>% 
  mutate(w.max.kg = w.max / weight) %>% 
  ggplot(aes(x = rel.vo2max,
             y = w.max.kg,
             color = id)) +
  geom_point() +
  labs(x = ("Relativ VO2maks"),
       y = ("Wattmaks/kg"),
       title = "Korrelasjon mellom Vo2maks og Wattmaks",
       subtitle = "Verdier er delt på vekt") 



```



### Data presentert i tekst

```{r}
#| code-fold: true
#| message: false
#| warning: false

df %>% 
  mutate(rel.vo2max = vo2.max / weight) %>% 
  summarise(VO2max = mean(vo2.max),
            wattmax = mean(w.max),
            weight = mean(weight),
            alder = mean(age),
            rel.o2 = mean(rel.vo2max)) %>% 
   gt() %>% 
  cols_label(VO2max = md("VO<sub>2maks</sub><br><small>ml/min</br></small>"),
             wattmax = md("Watt<br><small>maks</br></small>"),
             weight = "Vekt",
             alder = "Alder",
             rel.o2 = md("VO<sub>2maks</sub><br><small>ml/kg/min</br></small>")) %>% 
  fmt_number(columns = VO2max,
             decimals = 1) %>% 
  fmt_number(columns = wattmax,
             decimals = 0) %>% 
  fmt_number(columns = weight,
             decimals = 1) %>% 
  fmt_number(columns = alder,
             decimals = 0) %>% 
  fmt_number(columns = rel.o2,
             decimals = 2)
  df %>% 
            mutate(rel.vo2max = vo2.max / weight) %>% 
            summarise(VO2max.sd = sd(vo2.max),
            wattmax.sd = sd(w.max),
            weight.sd = sd(weight),
            alder.sd = sd(age),
            rel.o2.sd = sd(rel.vo2max)) %>% 
  gt() %>% 
    cols_label(VO2max.sd = md("VO<sub>2maks</sub> (±)"))
    
   



```


### Side-by-side table






