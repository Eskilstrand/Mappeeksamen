---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Assignment 1: Reliability and tools for reproducible data science {#assignment1}

The purpose of this assignment is to present estimates of reliability of measures collected in the physiology lab. A second purpose is to use tools for reproducible data science. The report that you are expected to hand in therefore has some strict requirements in its format (see [assignment description](https://dhammarstrom.github.io/quant-methods-workshops/assignment-1.html)). The assignment is a group assignment and at least three students are expected to contribute to each report.

## Elements of the report

**Importantly, the report should contain:**

-   At least one table (created from your data)
-   At least one figure (created from your data), and
-   data presented in the text.
-   The report should use a bibliography file to manage references.

## **Starten av rapport**

## Protokoll for VO2 max testing

### Forberedelse før test:

-   Gjennomfør samme type trening dagen før test
-   Standardiser siste måltid før test (frokost)
-   Innta normal mengde (for deg) med koffein før test
-   Unngå alkohol/nikotin/tobakk siste 72t før test
-   Tilstreb å legge seg omtrent til samme tid alle dager før test

### Arbeidsflyt:

1.  Skru på BIOSEN
2.  Finne frem slange
3.  Starte kalibrering av Vyntus
4.  Mens kalbibrering foregår skru sammen munnstykke
5.  Ta volumkalibrering
6.  Testperson kommer:
7.  Ta vekt
8.  Legge inn profil LODE og Vyntus
9.  Stille inn sykkel, montere pedaler
10. Kalibrere krank
11. Zeroing

### Standardisering før test

Utøveren skulle trene det samme dagen før test. Inntak av siste måltid før test skulle standardiseres, inntaket av koffein skulle være det samme før hver test. En skulle unngå inntak av alkohol og tobakk de siste 72 timene før test. Det skulle også tilstrebes å få like mye søvn før hver test.

### VO2maks test

Testen som ble gjennomført er VO2maks test på sykkel. VO2maks testen ble gjennomført på en ergometersykkel med bukkestyre (Lode Excalibur Sport; Lode B.V., Groningen, Nederland). Kranken kalibreres på Lode sykkelen før hver teststart, og sykkel stilles inn etter utøver sitt ønske ved første test og stilles inn til den samme sittestillingen påfølgende tester. For å måle det maksimale oksygenopptaket ble det brukt Vyntus (Jaeger Vyntus CPX, Hoechberg, Tyskland). Gassanalysator kalibreres til \< 2,0% differanse og luftvolum kalibreres til \< 0,2% differanse. Zeroing gjøres også alltid før test starter. Syklistene veies med de klærne de skal sykle med, og 0,3kg trekkes fra.

VO2maks testen gjennomføres etter en 5min standardisert oppvarming på ergometersykkelen. Oppvarmingen starter med en 2 min oppvarming på 11-12 i Borg, deretter 2min på 15 i Borg før 1min på 11-12 BORG. Testen starter på en belastning (Watt) basert på deltagerens nivå i samråd med utøver og testleder. Det viktigste er at påfølgende VO2maks tester starter på samme watt. Wattbelastningen økte med 20W eller 25W hvert minutt frem til utøveren når maksimal utmattelse er oppnådd. Maksimal utmattelse ble i denne sammenheng ikke evne til å kunne opprettholde RPM≤ 60. Under VO2maks var RPM valgfritt. Testleder gjør verbal oppmuntring og sekundering underveis i testen. Det blir målt oksygenmålinger hvert 30 sek, og de to høyeste påfølgende målingene blir definert som VO2maks. Umiddelbart etter test oppgir utøveren opplevd anstrengelse på BORG skala. Maks hjertefrekvens blir lest av fra utøverens egen pulsklokke. Blodprøve ble tatt fra utøverens fingertupp 1 min etter endt test for å måle \[BLa-\]. \[BLa-\] blir videre målt videre målt ved hjelp av en Biosen C-line (Biosen C-line Lactate Analyzer, EKF Diagnostic GmbH, Barleben, Germany)

## Referanser

Hopkins sier [@RN130]

```{r}
#| echo: false
#| message: false
#| warning: false

library(readxl)
library(tidyverse)
library(ggplot2)
library(dplyr)
library(magrittr)
library(gt)
df <- read_xlsx("data/o2-test.xlsx")

```

### Tabell over o2-tester med utvalgt data

```{r}
#| code-fold: true
#| warning: false
#| echo: false
#| message: false


df %>% 
  select(id, age, weight, w.max, vo2.max, hr.max, la.max, borg.max) %>% 
  mutate(rel.vo2max = vo2.max / weight) %>% 
  arrange(rel.vo2max) %>% 
  gt(auto_align = TRUE) %>% 
  tab_options(table.font.size = 12) |> 
  fmt_number(columns = w.max,
             decimals = 0) %>% 
  fmt_number(columns = vo2.max,
             decimals = 0) %>% 
  fmt_number(columns = rel.vo2max,
             decimals = 1) %>% 
  fmt_number(columns = age,
             decimals = 0) %>% 
  cols_label(id = "ID",
             age = "Alder",
             weight = "Vekt",
             w.max = md("Watt<sub>maks</sub>"),
             vo2.max = md("VO<sub>2maks</sub><br><small>(ml/min)</br></small>"),
             hr.max = md("HF<sub>maks</sub>"),
             la.max = md("Lak<sub>maks</sub>"),
             borg.max ="Borg",
             rel.vo2max = md("VO<sub>2maks</sub><br><small>(ml/kg/min)</br></small>"))
  




```

### Figur fra o2-test

```{r}
#| echo: false
#| message: false
#| warning: false


df %>% 
  mutate(rel.vo2max = vo2.max / weight) %>% 
  mutate(w.max.kg = w.max / weight) %>% 
  ggplot(aes(x = rel.vo2max,
             y = w.max.kg,
             color = id)) +
  geom_point() +
  labs(x = ("Relativ VO2maks"),
       y = ("Wattmaks/kg"),
       title = "Korrelasjon mellom Vo2maks og Wattmaks",
       subtitle = "Verdier er delt på vekt") 



```

### Data presentert i tekst

```{r}
#| echo: false
#| message: false
#| warning: false

df %>% 
  mutate(rel.vo2max = vo2.max / weight) %>% 
  summarise(VO2max = mean(vo2.max),
            wattmax = mean(w.max),
            weight = mean(weight),
            alder = mean(age),
            rel.o2 = mean(rel.vo2max)) %>% 
   gt() %>% 
  cols_label(VO2max = md("VO<sub>2maks</sub><br><small>ml/min</br></small>"),
             wattmax = md("Watt<br><small>maks</br></small>"),
             weight = "Vekt",
             alder = "Alder",
             rel.o2 = md("VO<sub>2maks</sub><br><small>ml/kg/min</br></small>")) %>% 
  fmt_number(columns = VO2max,
             decimals = 1) %>% 
  fmt_number(columns = wattmax,
             decimals = 0) %>% 
  fmt_number(columns = weight,
             decimals = 1) %>% 
  fmt_number(columns = alder,
             decimals = 0) %>% 
  fmt_number(columns = rel.o2,
             decimals = 2)
  df %>% 
            mutate(rel.vo2max = vo2.max / weight) %>% 
            summarise(VO2max.sd = sd(vo2.max),
            wattmax.sd = sd(w.max),
            weight.sd = sd(weight),
            alder.sd = sd(age),
            rel.o2.sd = sd(rel.vo2max)) %>% 
  gt() %>% 
    cols_label(VO2max.sd = md("VO<sub>2maks</sub> (±)"))
    
   



```

### Side-by-side table

```{r}
#| echo: false
#| tbl-cap: "Different values means (±)"

df %>% 
  # Velger ut hvilke verdier jeg vil ha med videre
  select(weight, vo2.max, w.max) %>% 
  
  # Oppretter nye verdier, for relativ vo2maks og wattmaks pr kg
  
  mutate(rel.vo2max = vo2.max / weight) %>% 
  mutate(rel.wmax = w.max / weight) %>% 
  
  # Samler verdiene weight:rel.wmax og tilhørende verdier i kolonne v siden av
  
  pivot_longer(names_to = "variables",
               values_to = "verdier",
               cols = weight:rel.wmax) %>% 
  
  # Grupperer etter variabler
  
  group_by(variables) %>% 
  
  # Regner ut snitt og standardavvik av verdiene
  
  summarise(gr.snitt = mean(verdier),
            gr.sd = sd(verdier),
            gr.var = var(verdier)) %>% 
  
  # setter sammen snitt og sd til en enkelt kolonne
  
    mutate(gr.snitt_sd = paste0(signif(gr.snitt, 3), " (", signif(gr.sd, 3), ")")) %>% 
  
  # Fjerner gruppering
  
  ungroup() %>% 
  
  # Velger vekk gr.snitt og gr.sd så det ikke synes i tabellen
  
    select(-gr.snitt, -gr.sd) %>% 
  
  # Printer tabellen
  
   gt() %>% 
  
  # Navngir kolonner
  
  cols_label(variables = "Variabler",
             gr.snitt_sd = "Gjennomsnitt (±)")
  
  


 



```


## Utregning av vanligste feil




